<?php
defined('BASEPATH') OR exit("LOL!");

/**
 * Description of Project
 *
 * @date 20-Mar-2016
 */
class Blogmodel extends CI_Model{
    public function __construct() {
        parent::__construct();
        $this->load->helper('url');
    }
    
    
        public function addblog($title, $body, $author, $logo){
        $data = ['title'=>$title, 'body'=>$body, 'author'=>$author, 'logo'=>$logo];
        
        $this->db->set('date_created', 'NOW()', FALSE);
        $this->db->set('uploaded_by', $session[id], FALSE);
        
        $this->db->insert('blogs', $data);
        
        if($this->db->insert_id()){
            return $this->db->insert_id();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    
    /**
     * 
     * @param type $customerId
     * @param type $firstName
     * @param type $lastName
     * @param type $otherName
     * @param type $mobile1
     * @param type $mobile2
     * @param type $email
     * @param type $gender
     * @param type $address
     * @param type $city
     * @param type $state
     * @param type $country
     * @return boolean
     */
    public function update($id, $title, $body, $author, $logo){
        $data = ['title'=>$title, 'body'=>$body, 'author'=>$author, 'logo'=>$logo];
        
        $this->db->where('id', $id);
        
        $this->db->update('blogs', $data);
        
        return TRUE;
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $order_by
     * @param type $order_format
     * @param type $start
     * @param type $limit
     * @return boolean
     */
    public function get_all($order_by, $order_format, $start, $limit){        
        $this->db->select('id, username, first_name, last_name, email, profession, mobile_1, mobile_2');
        $this->db->order_by($order_by, $order_format);
        $this->db->limit($limit, $start);
        
        $run_q = $this->db->get('users');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
   public function get_user_more_details($user_id){
       $this->db->select('logo, street, city, state, country, count(projects.id) as "total_projects_created", signup_date');
       $this->db->join('projects', 'users.id=projects.user_id', 'LEFT');
       $this->db->where('users.id', $user_id);
       
       $run_q = $this->db->get('users');
       
       if($run_q->num_rows()){
           return $run_q->result();
       }
       
       else{
           return FALSE;
       }
   }




   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function user_search($value){
        $q = "SELECT * FROM customers WHERE 
                first_name LIKE '%".$this->db->escape_like_str($value)."%'
                || last_name LIKE '%".$this->db->escape_like_str($value)."%' 
                || username LIKE '%".$this->db->escape_like_str($value)."%'
                || email LIKE '%".$this->db->escape_like_str($value)."%'
                || mobile_1 LIKE '%".$this->db->escape_like_str($value)."%'
                || mobile_2 LIKE '%".$this->db->escape_like_str($value)."%' 
                || city LIKE '%".$this->db->escape_like_str($value)."%'
                || state LIKE '%".$this->db->escape_like_str($value)."%'
                || country LIKE '%".$this->db->escape_like_str($value)."%'";
        
        $run_q = $this->db->query($q, [$value, $value, $value, $value, $value, $value, $value, $value, $value, $value]);
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
}
