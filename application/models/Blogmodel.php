<?php
defined('BASEPATH') OR exit("LOL!");

/**
 * Description of Project
 *
 * @date 20-Mar-2016
 */
class Blogmodel extends CI_Model{
    public function __construct() {
        parent::__construct();
        $this->load->helper('url');
    }
    
    
        public function addblog($title, $body, $author, $default_image){
        $data = ['title'=>$title, 'body'=>$body, 'author'=>$author, 'default_image'=>$default_image];
        $sessID = $this->session->userdata('admin_id'); //$_SESSION['admin_id']
     //   echo $sessID; exit;
        $this->db->set('date_created', 'NOW()', FALSE);
        $this->db->set('uploaded_by', $sessID, FALSE);
        
        $this->db->insert('blogs', $data);
        
        if($this->db->insert_id()){
            return $this->db->insert_id();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    
    /**
     * 
     * @param type $id
     * @param type $title
     * @param type $body
     * @param type $author
     * @param type $default_image
     * @return boolean
     */
    public function update($id, $title, $body, $author, $default_image){
        $data = $default_image ? ['title'=>$title, 'body'=>$body, 'author'=>$author, 'default_image'=>$default_image] 
                : 
            ['title'=>$title, 'body'=>$body, 'author'=>$author];
        
        $this->db->where('id', $id);
        
        $this->db->update('blogs', $data);
        
        return TRUE;
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $order_by
     * @param type $order_format
     * @param type $start
     * @param type $limit
     * @return boolean
     */
    public function get_all($order_by, $order_format, $start, $limit){        
        $this->db->select('blogs.id, title, body, author, users.username, date_created, last_edited, published');
        $this->db->join('users', 'users.id=blogs.uploaded_by');
        $this->db->order_by($order_by, $order_format);
        $this->db->limit($limit, $start);
        
        $run_q = $this->db->get('blogs');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
   public function get_user_more_details($user_id){
       $this->db->select('logo, street, city, state, country, count(projects.id) as "total_projects_created", signup_date');
       $this->db->join('projects', 'users.id=projects.user_id', 'LEFT');
       $this->db->where('users.id', $user_id);
       
       $run_q = $this->db->get('users');
       
       if($run_q->num_rows()){
           return $run_q->result();
       }
       
       else{
           return FALSE;
       }
   }




   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    public function getblogdet($id){        
        $this->db->select('id, title, body, author, default_image');
        $this->db->where('id', $id);
        $run_q = $this->db->get('blogs');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    

    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */

    public function user_search($value){
        $q = "SELECT * FROM customers WHERE 
                first_name LIKE '%".$this->db->escape_like_str($value)."%'
                || last_name LIKE '%".$this->db->escape_like_str($value)."%' 
                || username LIKE '%".$this->db->escape_like_str($value)."%'
                || email LIKE '%".$this->db->escape_like_str($value)."%'
                || mobile_1 LIKE '%".$this->db->escape_like_str($value)."%'
                || mobile_2 LIKE '%".$this->db->escape_like_str($value)."%' 
                || city LIKE '%".$this->db->escape_like_str($value)."%'
                || state LIKE '%".$this->db->escape_like_str($value)."%'
                || country LIKE '%".$this->db->escape_like_str($value)."%'";
        
        $run_q = $this->db->query($q, [$value, $value, $value, $value, $value, $value, $value, $value, $value, $value]);
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
}
